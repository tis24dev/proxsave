# ===============================================================
# GoReleaser configuration for Proxmox Backup (Go version)
# Maintainer: tis24dev
# ===============================================================

version: 2
project_name: proxsave
dist: build

before:
  hooks:
    - go mod tidy

###############################################
# BUILDS — principal binary
###############################################
builds:
  - id: proxsave
    main: ./cmd/proxsave
    binary: proxsave
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
    mod_timestamp: "{{ .CommitTimestamp }}"
    ldflags:
      - >-
        -s -w
        -X github.com/tis24dev/proxsave/internal/version.Version={{ .Version }}
        -X github.com/tis24dev/proxsave/internal/version.Commit={{ .FullCommit }}
        -X github.com/tis24dev/proxsave/internal/version.Date={{ .Date }}

###############################################
# ARCHIVI — tar.gz (classic release)
###############################################
archives:
  - id: archive
    ids:
      - proxsave
    formats:
      - tar.gz
    name_template: "{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}"
    files:
      - LICENSE
      - README.md

  - id: binary
    ids:
      - proxsave
    formats:
      - binary
    name_template: "{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}"

###############################################
# CHECKSUM
###############################################
checksum:
  name_template: "SHA256SUMS"

###############################################
# SBOM (CycloneDX via Syft)
###############################################
sboms:
  - id: archive-cyclonedx
    artifacts: archive
    documents:
      - "{{ .ArtifactName }}.sbom.cdx.json"
    cmd: syft
    args:
      - "$artifact"
      - "--output"
      - "cyclonedx-json=$document"

###############################################
# RELEASE — GitHub release + prerelease auto
###############################################
release:
  github:
    owner: tis24dev
    name: proxsave
  draft: false
  prerelease: auto
  name_template: "{{ .Tag }}"

###############################################
# CHANGELOG — 
###############################################
changelog:
  use: git
  sort: asc
  filters:
    exclude:
      - "^docs:"
      - "^test:"
      - "^chore:"
      - "^ci:"
      - "^refactor:"
